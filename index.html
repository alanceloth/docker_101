<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker 101 - Aprenda o b√°sico sobre Docker</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo-container">
                <a href="https://suajornadadedados.com.br/" target="_blank">
                    <img src="images/LOGO.png" alt="Docker 101 Logo" class="logo">
                </a>
            </div>
            <h1>Docker 101</h1>
            <p class="subtitle">Um guia para iniciantes sobre containeriza√ß√£o</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="#o-problema">O Problema</a></li>
                <li><a href="#o-que-sao-containers">O que s√£o Containers</a></li>
                <li><a href="#o-que-e">O que √© Docker</a></li>
                <li><a href="#para-que-serve">Para que serve</a></li>
                <li><a href="#beneficios">Benef√≠cios</a></li>
                <li><a href="#problemas">Problemas resolvidos</a></li>
                <li><a href="#exemplos">Exemplos</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <section id="o-problema">
            <h2>O Problema: "Funciona na minha m√°quina"</h2>
            <div class="content-box">
                <div class="intro-story">
                    <div class="story-scenario">
                        <h3>Imagine esta situa√ß√£o...</h3>
                        
                        <div class="story-scene">
                            <div class="scene-part">
                                <img src="images/dev-machine.png" alt="Desenvolvedor feliz" class="scene-image">
                                <div class="scene-caption">
                                    <h4>Alan: Desenvolvedor</h4>
                                    <p>"Meu aplicativo funciona perfeitamente no meu computador!"</p>
                                </div>
                            </div>
                            
                            <div class="scene-arrow">
                                <div class="arrow-line"></div>
                                <div class="arrow-head"></div>
                            </div>
                            
                            <div class="scene-part">
                                <img src="images/prod-server.png" alt="Servidor de produ√ß√£o com erro" class="scene-image">
                                <div class="scene-caption">
                                    <h4>Servidor de Produ√ß√£o</h4>
                                    <p>"ERRO: Depend√™ncias incompat√≠veis!"</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="problem-quote">
                            <blockquote>"Mas funciona na minha m√°quina!"</blockquote>
                            <p>- Todo desenvolvedor, em algum momento</p>
                        </div>
                    </div>
                    
                    <div class="why-this-happens">
                        <h3>Por que isso acontece?</h3>
                        
                        <div class="environment-differences">
                            <div class="env-item">
                                <div class="env-icon">üñ•Ô∏è</div>
                                <h4>Vers√µes de Software</h4>
                                <p>Python 3.8 vs Python 3.10</p>
                            </div>
                            
                            <div class="env-item">
                                <div class="env-icon">üìö</div>
                                <h4>Bibliotecas</h4>
                                <p>Vers√µes diferentes de depend√™ncias</p>
                            </div>
                            
                            <div class="env-item">
                                <div class="env-icon">‚öôÔ∏è</div>
                                <h4>Configura√ß√µes</h4>
                                <p>Caminhos de arquivos, vari√°veis de ambiente</p>
                            </div>
                            
                            <div class="env-item">
                                <div class="env-icon">üíæ</div>
                                <h4>Sistema Operacional</h4>
                                <p>Windows vs Linux vs macOS</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="solution-preview">
                    <h3>A solu√ß√£o: Empacotar tudo junto!</h3>
                    
                    <div class="analogy-container">
                        <div class="analogy-part">
                            <h4>Problema: Transporte de itens soltos</h4>
                            <div class="analogy-image-container">
                                <img src="images/loose-items.png" alt="Itens soltos dif√≠ceis de transportar" class="analogy-image">
                            </div>
                            <ul>
                                <li>Dif√≠cil de transportar</li>
                                <li>Itens podem se perder</li>
                                <li>Cada item precisa de tratamento diferente</li>
                            </ul>
                        </div>
                        
                        <div class="analogy-arrow">
                            <div class="arrow-line"></div>
                            <div class="arrow-head"></div>
                        </div>
                        
                        <div class="analogy-part">
                            <h4>Solu√ß√£o: Cont√™ineres padronizados</h4>
                            <div class="analogy-image-container">
                                <img src="images/shipping-container.png" alt="Cont√™iner de transporte padronizado" class="analogy-image">
                            </div>
                            <ul>
                                <li>Formato padronizado</li>
                                <li>F√°cil de transportar</li>
                                <li>Protege o conte√∫do</li>
                                <li>Mesmo tratamento para qualquer carga</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="solution-transition">
                        <p>Na programa√ß√£o, <strong>Docker</strong> resolve este problema criando "cont√™ineres" para suas aplica√ß√µes, garantindo que funcionem em qualquer lugar da mesma forma.</p>
                        <div class="lets-learn-more">
                            <p>Vamos entender como isso funciona...</p>
                            <div class="arrow-down"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="o-que-sao-containers">
            <h2>O que s√£o Containers</h2>
            <div class="content-box">
                <p>Antes de entendermos o Docker, precisamos compreender o conceito fundamental de <strong>containers</strong>.</p>
                
                <p>Um <strong>container</strong> √© uma unidade padronizada de software que empacota o c√≥digo e todas as suas depend√™ncias, permitindo que a aplica√ß√£o seja executada de forma r√°pida e confi√°vel de um ambiente computacional para outro.</p>

                <div class="container-explanation">
                    <div class="container-points">
                        <h3>Caracter√≠sticas dos Containers:</h3>
                        <ul>
                            <li><strong>Isolamento</strong>: Cada container opera de forma independente, sem interferir em outros containers ou no sistema hospedeiro</li>
                            <li><strong>Portabilidade</strong>: Executa o mesmo em qualquer ambiente, seja um notebook, servidor ou nuvem</li>
                            <li><strong>Efici√™ncia</strong>: Compartilha o kernel do sistema operacional hospedeiro, tornando-os mais leves que m√°quinas virtuais</li>
                            <li><strong>Consist√™ncia</strong>: Garante que o software sempre execute da mesma maneira, independentemente do ambiente</li>
                        </ul>
                    </div>
                    <div class="container-metaphor">
                        <h3>Uma analogia pr√°tica:</h3>
                        <p>Pense em containers como <strong>cont√™ineres de carga</strong> (da√≠ o nome) usados para transporte mar√≠timo:</p>
                        <ul>
                            <li>Cada cont√™iner tem um <strong>formato padronizado</strong> que se encaixa em qualquer navio de carga, caminh√£o ou trem</li>
                            <li>O que est√° <strong>dentro do cont√™iner</strong> n√£o importa para o sistema de transporte</li>
                            <li>O conte√∫do est√° <strong>isolado e protegido</strong> durante todo o transporte</li>
                            <li>Diferentes cont√™ineres podem transportar <strong>diferentes tipos de carga</strong>, mas s√£o manipulados da mesma forma</li>
                        </ul>
                    </div>
                </div>
                
                <p>Na tecnologia, containers solucionam o problema de "funciona na minha m√°quina", pois garantem que o ambiente de execu√ß√£o seja o mesmo em qualquer lugar. Um container inclui tudo que o aplicativo precisa para funcionar: c√≥digo, runtime, bibliotecas, vari√°veis de ambiente, arquivos de configura√ß√£o, etc.</p>
            </div>
        </section>

        <section id="o-que-e">
            <h2>O que √© Docker</h2>
            <div class="content-box">
                <p>Docker √© uma plataforma de c√≥digo aberto que automatiza o processo de implanta√ß√£o de aplicativos dentro de <strong>cont√™ineres</strong>. Isso permite que os aplicativos sejam executados no mesmo ambiente, independentemente de onde estejam sendo executados.</p>
                
                <div class="image-container">
                    <img src="images/docker-vs-vm.png" alt="Docker vs M√°quinas Virtuais" class="content-image">
                    <p class="caption">Docker (cont√™ineres) vs M√°quinas Virtuais</p>
                </div>
                
                <p>Um <strong>cont√™iner</strong> √© uma unidade padronizada de software que empacota o c√≥digo e todas as suas depend√™ncias para que o aplicativo seja executado de forma r√°pida e confi√°vel de um ambiente computacional para outro.</p>
            </div>
        </section>

        <section id="para-que-serve">
            <h2>Para que serve Docker</h2>
            <div class="content-box">
                <p>Docker serve para:</p>
                <ul>
                    <li><strong>Padronizar ambientes</strong>: "Funciona na minha m√°quina" deixa de ser um problema</li>
                    <li><strong>Isolar aplica√ß√µes</strong>: Cada aplica√ß√£o roda em seu pr√≥prio ambiente isolado</li>
                    <li><strong>Facilitar a implanta√ß√£o</strong>: Implantar aplica√ß√µes se torna mais simples e previs√≠vel</li>
                    <li><strong>Escalar facilmente</strong>: Iniciar novos cont√™ineres conforme a necessidade</li>
                    <li><strong>Gerenciar infraestrutura</strong>: Tratar a infraestrutura como c√≥digo</li>
                </ul>
            </div>
        </section>

        <section id="beneficios">
            <h2>Benef√≠cios do uso de Docker</h2>
            <div class="content-box">
                <div class="card-container">
                    <div class="card">
                        <h3>Consist√™ncia</h3>
                        <p>Ambientes id√™nticos do desenvolvimento √† produ√ß√£o</p>
                    </div>
                    <div class="card">
                        <h3>Velocidade</h3>
                        <p>Implanta√ß√£o e inicializa√ß√£o muito mais r√°pidas que VMs</p>
                    </div>
                    <div class="card">
                        <h3>Isolamento</h3>
                        <p>Aplica√ß√µes isoladas sem interferir umas nas outras</p>
                    </div>
                    <div class="card">
                        <h3>Efici√™ncia</h3>
                        <p>Uso mais eficiente de recursos comparado √†s VMs</p>
                    </div>
                    <div class="card">
                        <h3>Portabilidade</h3>
                        <p>Execute em qualquer lugar que tenha Docker instalado</p>
                    </div>
                    <div class="card">
                        <h3>Versionamento</h3>
                        <p>Controle de vers√£o das imagens e f√°cil rollback</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="problemas">
            <h2>Problemas que o Docker resolve</h2>
            <div class="content-box">
                <div class="problem-solution">
                    <div class="problem">
                        <h3>Problema: "Funciona na minha m√°quina"</h3>
                        <p>Desenvolvedores e opera√ß√µes frequentemente enfrentam problemas quando o c√≥digo funciona em um ambiente (como o laptop do desenvolvedor) mas falha em outro (como o servidor de produ√ß√£o).</p>
                    </div>
                    <div class="solution">
                        <h3>Solu√ß√£o com Docker</h3>
                        <p>Cont√™ineres garantem que o ambiente de execu√ß√£o seja exatamente o mesmo em qualquer lugar.</p>
                    </div>
                </div>

                <div class="problem-solution">
                    <div class="problem">
                        <h3>Problema: Conflito de depend√™ncias</h3>
                        <p>Aplica√ß√µes diferentes podem precisar de vers√µes diferentes da mesma biblioteca, causando conflitos.</p>
                    </div>
                    <div class="solution">
                        <h3>Solu√ß√£o com Docker</h3>
                        <p>Cada cont√™iner tem suas pr√≥prias depend√™ncias isoladas.</p>
                    </div>
                </div>

                <div class="problem-solution">
                    <div class="problem">
                        <h3>Problema: Configura√ß√£o complexa de ambiente</h3>
                        <p>Configurar ambientes de desenvolvimento pode ser demorado e propenso a erros.</p>
                    </div>
                    <div class="solution">
                        <h3>Solu√ß√£o com Docker</h3>
                        <p>Configura√ß√£o automatizada atrav√©s de Dockerfiles e Docker Compose.</p>
                    </div>
                </div>

                <div class="problem-solution">
                    <div class="problem">
                        <h3>Problema: Escalabilidade dif√≠cil</h3>
                        <p>Escalar aplica√ß√µes tradicionais pode ser um processo complexo.</p>
                    </div>
                    <div class="solution">
                        <h3>Solu√ß√£o com Docker</h3>
                        <p>F√°cil escala horizontal com orquestradores como Docker Swarm e Kubernetes.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="exemplos">
            <h2>Exemplos pr√°ticos de uso do Docker</h2>
            
            <div class="example" id="exemplo1">
                <h3>Exemplo 1: Dashboard de Dados com Streamlit</h3>
                <div class="content-box">
                    <p>Criando um dashboard interativo de visualiza√ß√£o de dados com Streamlit e empacotando-o em um cont√™iner Docker.</p>
                    <div class="code-tabs">
                        <button class="tab-button active" onclick="showTab('exemplo1-codigo')">C√≥digo Python</button>
                        <button class="tab-button" onclick="showTab('exemplo1-dockerfile')">Dockerfile</button>
                        <button class="tab-button" onclick="showTab('exemplo1-comandos')">Comandos</button>
                    </div>
                    <div id="exemplo1-codigo" class="tab-content active">
                        <pre><code class="language-python"># app.py
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# Configura√ß√£o da p√°gina
st.set_page_config(page_title="Dashboard de Vendas", layout="wide")

# T√≠tulo
st.title("Dashboard de Vendas - 2023")

# Carregar dados de exemplo
@st.cache_data
def load_data():
    # NOTA: No exemplo isolado, usamos dados est√°ticos
    # No exemplo do Docker Compose, estes dados vir√£o da API
    data = {
        'M√™s': ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
        'Vendas': [15000, 17500, 19800, 22300, 21500, 25000]
    }
    return pd.DataFrame(data)

df = load_data()

# Mostrar dados
st.subheader("Dados de Vendas")
st.dataframe(df)

# Visualiza√ß√£o
st.subheader("Tend√™ncia de Vendas")
fig, ax = plt.subplots(figsize=(10, 4))
ax.plot(df['M√™s'], df['Vendas'], marker='o')
ax.set_ylabel('Vendas (R$)')
ax.grid(True)
st.pyplot(fig)

# M√©tricas
st.subheader("M√©tricas")
col1, col2, col3 = st.columns(3)
with col1:
    st.metric("Total de Vendas", f"R$ {df['Vendas'].sum():,.2f}")
with col2:
    st.metric("M√©dia Mensal", f"R$ {df['Vendas'].mean():,.2f}")
with col3:
    st.metric("Crescimento", f"{((df['Vendas'].iloc[-1] / df['Vendas'].iloc[0]) - 1) * 100:.1f}%")</code></pre>
                    </div>
                    <div id="exemplo1-dockerfile" class="tab-content">
                        <pre><code class="language-dockerfile"># Dockerfile
FROM python:3.10-slim

WORKDIR /app

# Instalar depend√™ncias
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copiar c√≥digo
COPY . .

# Expor porta para o Streamlit
EXPOSE 8501

# Comando para iniciar o Streamlit
CMD ["streamlit", "run", "app.py", "--server.address=0.0.0.0"]</code></pre>
                    </div>
                    <div id="exemplo1-comandos" class="tab-content">
                        <pre><code class="language-bash"># Criar o arquivo requirements.txt
echo "streamlit==1.31.0
pandas==2.1.0
matplotlib==3.8.0" > requirements.txt

# Construir a imagem Docker
docker build -t dashboard-vendas .

# Executar o cont√™iner
docker run -p 8501:8501 -d --name streamlit-app dashboard-vendas

# Acessar o dashboard
# Abra seu navegador em http://localhost:8501</code></pre>
                    </div>
                    <div class="example-description">
                        <p><strong>Benef√≠cios neste exemplo:</strong></p>
                        <ul>
                            <li>Dashboard de visualiza√ß√£o de dados pronto para uso em qualquer ambiente</li>
                            <li>Sem necessidade de instalar Python, Streamlit ou outras depend√™ncias no host</li>
                            <li>Portabilidade para compartilhar facilmente com a equipe</li>
                            <li>Ambiente isolado com vers√µes espec√≠ficas das bibliotecas</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="example" id="exemplo2">
                <h3>Exemplo 2: API de Dados com FastAPI</h3>
                <div class="content-box">
                    <p>Criando uma API para acesso a dados usando FastAPI em um cont√™iner Docker.</p>
                    <div class="code-tabs">
                        <button class="tab-button active" onclick="showTab('exemplo2-codigo')">C√≥digo Python</button>
                        <button class="tab-button" onclick="showTab('exemplo2-dockerfile')">Dockerfile</button>
                        <button class="tab-button" onclick="showTab('exemplo2-comandos')">Comandos</button>
                    </div>
                    <div id="exemplo2-codigo" class="tab-content active">
                        <pre><code class="language-python"># main.py
from fastapi import FastAPI, Query, Body
from pydantic import BaseModel
from typing import List, Optional
import pandas as pd

app = FastAPI(title="API de Dados de Vendas")

# Dados simulados - no exemplo isolado, usamos estes dados
# No exemplo do Docker Compose, estes dados viriam do banco PostgreSQL
vendas_df = pd.DataFrame({
    'id': range(1, 11),
    'produto': ['Laptop', 'Mouse', 'Teclado', 'Monitor', 'Headphone', 
                'Webcam', 'SSD', 'RAM', 'GPU', 'CPU'],
    'categoria': ['Computadores', 'Acess√≥rios', 'Acess√≥rios', 'Perif√©ricos', '√Åudio',
                 'Perif√©ricos', 'Componentes', 'Componentes', 'Componentes', 'Componentes'],
    'preco': [3500, 150, 200, 1200, 350, 180, 450, 300, 2000, 1500],
    'quantidade_vendida': [12, 85, 63, 35, 42, 30, 55, 70, 22, 25]
})

class Produto(BaseModel):
    id: int
    produto: str
    categoria: str
    preco: float
    quantidade_vendida: int

class ProdutoCreate(BaseModel):
    produto: str
    categoria: str
    preco: float
    quantidade_vendida: int

@app.get("/")
def read_root():
    return {"mensagem": "API de Dados de Vendas"}

@app.get("/produtos", response_model=List[Produto])
def get_produtos(
    categoria: Optional[str] = Query(None, description="Filtrar por categoria"),
    min_preco: Optional[float] = Query(None, description="Pre√ßo m√≠nimo"),
    max_preco: Optional[float] = Query(None, description="Pre√ßo m√°ximo")
):
    df = vendas_df.copy()
    
    if categoria:
        df = df[df['categoria'] == categoria]
    
    if min_preco is not None:
        df = df[df['preco'] >= min_preco]
    
    if max_preco is not None:
        df = df[df['preco'] <= max_preco]
    
    return df.to_dict(orient='records')

@app.get("/produtos/{produto_id}", response_model=Produto)
def get_produto(produto_id: int):
    produto = vendas_df[vendas_df['id'] == produto_id]
    if not produto.empty:
        return produto.iloc[0].to_dict()
    return {"erro": "Produto n√£o encontrado"}

# NOTA: Apenas no Docker Compose teremos a funcionalidade POST
# abaixo est√° um exemplo de como seria implementado
"""
@app.post("/produtos", response_model=Produto)
def create_produto(produto: ProdutoCreate):
    # No exemplo do Docker Compose, este m√©todo salvaria no PostgreSQL
    global vendas_df
    
    novo_id = vendas_df['id'].max() + 1 if not vendas_df.empty else 1
    novo_produto = {
        'id': novo_id,
        **produto.dict()
    }
    
    vendas_df = pd.concat([vendas_df, pd.DataFrame([novo_produto])])
    return novo_produto
"""</code></pre>
                    </div>
                    <div id="exemplo2-dockerfile" class="tab-content">
                        <pre><code class="language-dockerfile"># Dockerfile
FROM python:3.10-slim

WORKDIR /app

# Copiar e instalar depend√™ncias
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copiar c√≥digo
COPY . .

# Expor porta para a API
EXPOSE 8000

# Iniciar API com Uvicorn
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]</code></pre>
                    </div>
                    <div id="exemplo2-comandos" class="tab-content">
                        <pre><code class="language-bash"># Criar o arquivo requirements.txt
echo "fastapi==0.104.0
uvicorn==0.23.2
pandas==2.1.0
pydantic==2.4.2" > requirements.txt

# Construir a imagem Docker
docker build -t api-vendas .

# Executar o cont√™iner
docker run -p 8000:8000 -d --name fastapi-app api-vendas

# Testar a API
# Acesse http://localhost:8000/docs para ver a documenta√ß√£o interativa</code></pre>
                    </div>
                    <div class="example-description">
                        <p><strong>Benef√≠cios neste exemplo:</strong></p>
                        <ul>
                            <li>API de dados pronta para consumo por outras aplica√ß√µes</li>
                            <li>Documenta√ß√£o interativa autom√°tica com Swagger UI</li>
                            <li>Isolamento de depend√™ncias e vers√µes espec√≠ficas</li>
                            <li>F√°cil implanta√ß√£o em qualquer ambiente que tenha Docker</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="example" id="exemplo3">
                <h3>Exemplo 3: Banco de Dados PostgreSQL</h3>
                <div class="content-box">
                    <p>Executando um banco de dados PostgreSQL para an√°lise de dados em um cont√™iner Docker.</p>
                    <div class="code-tabs">
                        <button class="tab-button active" onclick="showTab('exemplo3-comandos')">Comandos Docker</button>
                        <button class="tab-button" onclick="showTab('exemplo3-sql')">Consultas SQL</button>
                        <button class="tab-button" onclick="showTab('exemplo3-volume')">Persist√™ncia</button>
                    </div>
                    <div id="exemplo3-comandos" class="tab-content active">
                        <pre><code class="language-bash"># Iniciar cont√™iner PostgreSQL
docker run --name postgres-dados -e POSTGRES_PASSWORD=segredo -e POSTGRES_USER=analista -e POSTGRES_DB=datawarehouse -p 5432:5432 -d postgres:14.8

# Verificar status do cont√™iner
docker ps

# Executar o cliente psql dentro do cont√™iner
docker exec -it postgres-dados psql -U analista -d datawarehouse

# No exemplo isolado, o banco come√ßa vazio
# No Docker Compose, ser√° preenchido com dados iniciais e atrav√©s da API

# Parar o cont√™iner
docker stop postgres-dados

# Reiniciar o cont√™iner
docker start postgres-dados</code></pre>
                    </div>
                    <div id="exemplo3-sql" class="tab-content">
                        <pre><code class="language-sql">-- Criar tabela para armazenar dados
CREATE TABLE vendas (
    id SERIAL PRIMARY KEY,
    data_venda DATE NOT NULL,
    produto VARCHAR(100) NOT NULL,
    categoria VARCHAR(50) NOT NULL,
    valor DECIMAL(10,2) NOT NULL,
    quantidade INT NOT NULL
);

-- Inserir dados de exemplo
INSERT INTO vendas (data_venda, produto, categoria, valor, quantidade)
VALUES 
  ('2023-01-15', 'Curso Python', 'Educa√ß√£o', 197.00, 45),
  ('2023-01-20', 'Assinatura BI', 'Software', 89.90, 28),
  ('2023-02-05', 'Consultoria', 'Servi√ßos', 1200.00, 3),
  ('2023-02-12', 'Curso SQL', 'Educa√ß√£o', 147.00, 52),
  ('2023-03-01', 'Licen√ßa Tableau', 'Software', 999.00, 15);

-- An√°lise de vendas por categoria
SELECT 
    categoria,
    COUNT(*) AS total_vendas,
    SUM(valor * quantidade) AS receita_total,
    AVG(valor) AS ticket_medio
FROM vendas
GROUP BY categoria
ORDER BY receita_total DESC;</code></pre>
                    </div>
                    <div id="exemplo3-volume" class="tab-content">
                        <pre><code class="language-bash"># Executar PostgreSQL com volume para persist√™ncia
docker run --name postgres-dados \
  -e POSTGRES_PASSWORD=segredo \
  -e POSTGRES_USER=analista \
  -e POSTGRES_DB=datawarehouse \
  -v postgres_data:/var/lib/postgresql/data \
  -p 5432:5432 \
  -d postgres:14.8

# Acessar usando ferramentas externas
# Host: localhost
# Port: 5432
# User: analista
# Password: segredo
# Database: datawarehouse

# Criar backup do banco de dados
docker exec -t postgres-dados pg_dump -U analista -d datawarehouse > backup.sql

# Restaurar backup (para um cont√™iner novo)
# 1. Criar novo cont√™iner
docker run --name postgres-dados-novo -e POSTGRES_PASSWORD=segredo -e POSTGRES_USER=analista -e POSTGRES_DB=datawarehouse -v postgres_data_novo:/var/lib/postgresql/data -p 5433:5432 -d postgres:14.8

# 2. Restaurar dados
cat backup.sql | docker exec -i postgres-dados-novo psql -U analista -d datawarehouse</code></pre>
                    </div>
                    <div class="example-description">
                        <p><strong>Benef√≠cios neste exemplo:</strong></p>
                        <ul>
                            <li>Banco de dados para an√°lise pronto para uso em segundos</li>
                            <li>Persist√™ncia de dados com volumes Docker</li>
                            <li>Isolamento completo do sistema host</li>
                            <li>F√°cil backup e restaura√ß√£o</li>
                            <li>Possibilidade de executar m√∫ltiplas vers√µes do PostgreSQL no mesmo sistema</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="example" id="exemplo4">
                <h3>Exemplo 4: Aplica√ß√£o Completa de An√°lise de Dados com Docker Compose</h3>
                <div class="content-box">
                    <p>Combinando PostgreSQL, FastAPI e Streamlit em uma stack completa de an√°lise de dados usando Docker Compose.</p>
                    <div class="code-tabs">
                        <button class="tab-button active" onclick="showTab('exemplo4-compose')">docker-compose.yml</button>
                        <button class="tab-button" onclick="showTab('exemplo4-fastapi')">API (FastAPI)</button>
                        <button class="tab-button" onclick="showTab('exemplo4-streamlit')">Dashboard</button>
                        <button class="tab-button" onclick="showTab('exemplo4-comandos')">Comandos</button>
                    </div>
                    <div id="exemplo4-compose" class="tab-content active">
                        <pre><code class="language-yaml"># docker-compose.yml
version: '3.8'

services:
  # Banco de dados
  db:
    image: postgres:14.8
    container_name: postgres-analytics
    environment:
      - POSTGRES_USER=analista
      - POSTGRES_PASSWORD=segredo
      - POSTGRES_DB=datawarehouse
    volumes:
      - postgres_data:/var/lib/postgresql/data
      # Inicializa√ß√£o do banco com script SQL
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U analista -d datawarehouse"]
      interval: 10s
      timeout: 5s
      retries: 5

  # API para acesso aos dados
  api:
    build: ./api
    container_name: dados-api
    depends_on:
      db:
        condition: service_healthy
    environment:
      - DATABASE_URL=postgresql://analista:segredo@db:5432/datawarehouse
    ports:
      - "8000:8000"

  # Dashboard para visualiza√ß√£o
  dashboard:
    build: ./dashboard
    container_name: dados-dashboard
    depends_on:
      - api
    environment:
      - API_URL=http://api:8000
    ports:
      - "8501:8501"

volumes:
  postgres_data:</code></pre>
                    </div>
                    <div id="exemplo4-fastapi" class="tab-content">
                        <pre><code class="language-python"># api/main.py
from fastapi import FastAPI, Depends, HTTPException, Body
from sqlalchemy import create_engine, Column, Integer, String, Float, Date, func
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker, Session
import os
from datetime import date
from pydantic import BaseModel
from typing import List, Optional

# Configura√ß√£o do banco de dados
DATABASE_URL = os.environ.get("DATABASE_URL")
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()

# Modelo SQLAlchemy
class VendaDB(Base):
    __tablename__ = "vendas"
    
    id = Column(Integer, primary_key=True, index=True)
    data_venda = Column(Date)
    produto = Column(String)
    categoria = Column(String)
    valor = Column(Float)
    quantidade = Column(Integer)

# Modelo Pydantic para leitura
class Venda(BaseModel):
    id: int
    data_venda: date
    produto: str
    categoria: str
    valor: float
    quantidade: int
    
    class Config:
        orm_mode = True

# Modelo Pydantic para cria√ß√£o
class VendaCreate(BaseModel):
    data_venda: date
    produto: str
    categoria: str
    valor: float
    quantidade: int

# Depend√™ncia para obter a sess√£o do banco
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

app = FastAPI(title="API de An√°lise de Dados")

@app.get("/vendas", response_model=List[Venda])
def listar_vendas(db: Session = Depends(get_db)):
    return db.query(VendaDB).all()

@app.get("/vendas/categoria/{categoria}", response_model=List[Venda])
def vendas_por_categoria(categoria: str, db: Session = Depends(get_db)):
    return db.query(VendaDB).filter(VendaDB.categoria == categoria).all()

@app.get("/vendas/analise")
def analise_vendas(db: Session = Depends(get_db)):
    resultado = db.query(
        VendaDB.categoria,
        func.count(VendaDB.id).label("total_vendas"),
        func.sum(VendaDB.valor * VendaDB.quantidade).label("receita_total"),
        func.avg(VendaDB.valor).label("ticket_medio")
    ).group_by(VendaDB.categoria).all()
    
    return [
        {
            "categoria": r.categoria,
            "total_vendas": r.total_vendas,
            "receita_total": float(r.receita_total),
            "ticket_medio": float(r.ticket_medio)
        }
        for r in resultado
    ]

# Endpoint para inserir novos dados - dispon√≠vel apenas no Docker Compose
@app.post("/vendas", response_model=Venda)
def criar_venda(venda: VendaCreate, db: Session = Depends(get_db)):
    nova_venda = VendaDB(**venda.dict())
    db.add(nova_venda)
    db.commit()
    db.refresh(nova_venda)
    return nova_venda</code></pre>
                    </div>
                    <div id="exemplo4-streamlit" class="tab-content">
                        <pre><code class="language-python"># dashboard/app.py
import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
import requests
import os
import json
from datetime import datetime

# Configura√ß√£o
API_URL = os.environ.get("API_URL", "http://api:8000")

st.set_page_config(
    page_title="Dashboard de An√°lise de Vendas",
    layout="wide",
    initial_sidebar_state="expanded"
)

# T√≠tulo
st.title("Dashboard de An√°lise de Vendas")
st.write("Dashboard interativo para an√°lise de dados de vendas")

# Fun√ß√µes para carregar dados da API
@st.cache_data(ttl=300)
def carregar_vendas():
    response = requests.get(f"{API_URL}/vendas")
    return pd.DataFrame(response.json())

@st.cache_data(ttl=300)
def carregar_analise():
    response = requests.get(f"{API_URL}/vendas/analise")
    return pd.DataFrame(response.json())

# Fun√ß√£o para inserir novos dados
def inserir_venda(dados):
    response = requests.post(f"{API_URL}/vendas", json=dados)
    return response.status_code == 200 or response.status_code == 201

try:
    # Carregar dados
    df_vendas = carregar_vendas()
    df_analise = carregar_analise()
    
    # Criar abas para separar visualiza√ß√£o e entrada de dados
    tab1, tab2 = st.tabs(["Visualiza√ß√£o de Dados", "Inserir Novos Dados"])
    
    with tab1:
        # Layout em colunas
        col1, col2 = st.columns(2)
        
        # Coluna 1: Gr√°fico de barras - Receita por categoria
        with col1:
            st.subheader("Receita Total por Categoria")
            fig1 = px.bar(
                df_analise, 
                x="categoria", 
                y="receita_total",
                text_auto=True,
                color="categoria",
                title="Receita Total por Categoria de Produto"
            )
            st.plotly_chart(fig1, use_container_width=True)
        
        # Coluna 2: Gr√°fico de pizza - Propor√ß√£o de vendas
        with col2:
            st.subheader("Propor√ß√£o de Vendas por Categoria")
            fig2 = px.pie(
                df_analise, 
                values="total_vendas", 
                names="categoria",
                title="Distribui√ß√£o de Vendas por Categoria"
            )
            st.plotly_chart(fig2, use_container_width=True)
        
        # Tabela completa
        st.subheader("Dados de Vendas")
        st.dataframe(df_vendas)
        
        # Filtro por categoria
        st.sidebar.title("Filtros")
        categorias = ["Todas"] + sorted(df_vendas["categoria"].unique().tolist())
        categoria_selecionada = st.sidebar.selectbox("Selecione uma categoria:", categorias)
        
        if categoria_selecionada != "Todas":
            df_filtrado = df_vendas[df_vendas["categoria"] == categoria_selecionada]
            st.subheader(f"Vendas na categoria: {categoria_selecionada}")
            st.dataframe(df_filtrado)
            
            # Gr√°fico de linha para a categoria
            if not df_filtrado.empty:
                df_por_data = df_filtrado.groupby("data_venda").agg(
                    {"valor": lambda x: (x * df_filtrado["quantidade"]).sum()}
                ).reset_index()
                df_por_data.columns = ["data", "receita"]
                
                fig3 = px.line(
                    df_por_data, 
                    x="data", 
                    y="receita",
                    markers=True,
                    title=f"Evolu√ß√£o de Receita: {categoria_selecionada}"
                )
                st.plotly_chart(fig3, use_container_width=True)
    
    with tab2:
        # Formul√°rio para adicionar novas vendas
        st.subheader("Adicionar Nova Venda")
        with st.form("nova_venda_form"):
            data_venda = st.date_input("Data da Venda", datetime.now().date())
            produto = st.text_input("Nome do Produto")
            
            # Usar categorias existentes ou permitir nova
            usar_categoria_existente = st.checkbox("Usar categoria existente", value=True)
            if usar_categoria_existente and not df_vendas.empty:
                categoria = st.selectbox("Categoria", sorted(df_vendas["categoria"].unique().tolist()))
            else:
                categoria = st.text_input("Nova Categoria")
                
            valor = st.number_input("Valor Unit√°rio (R$)", min_value=0.01, format="%.2f")
            quantidade = st.number_input("Quantidade", min_value=1, step=1)
            
            submitted = st.form_submit_button("Adicionar Venda")
            
            if submitted:
                if not produto or not categoria:
                    st.error("Todos os campos s√£o obrigat√≥rios!")
                else:
                    nova_venda = {
                        "data_venda": data_venda.isoformat(),
                        "produto": produto,
                        "categoria": categoria,
                        "valor": valor,
                        "quantidade": quantidade
                    }
                    
                    if inserir_venda(nova_venda):
                        st.success("Venda adicionada com sucesso!")
                        st.cache_data.clear()  # Limpar cache para recarregar dados
                    else:
                        st.error("Erro ao adicionar venda. Verifique os dados e tente novamente.")
    
except Exception as e:
    st.error(f"Erro ao carregar dados: {e}")
    st.warning("Verifique se a API est√° dispon√≠vel e funcionando corretamente.")</code></pre>
                    </div>
                    <div id="exemplo4-comandos" class="tab-content">
                        <pre><code class="language-bash"># Estrutura de diret√≥rios
mkdir -p projeto-dados/{api,dashboard}

# Criar script de inicializa√ß√£o do banco
cat > init.sql << 'EOF'
CREATE TABLE vendas (
    id SERIAL PRIMARY KEY,
    data_venda DATE NOT NULL,
    produto VARCHAR(100) NOT NULL,
    categoria VARCHAR(50) NOT NULL,
    valor DECIMAL(10,2) NOT NULL,
    quantidade INT NOT NULL
);

INSERT INTO vendas (data_venda, produto, categoria, valor, quantidade)
VALUES 
  ('2023-01-15', 'Curso Python', 'Educa√ß√£o', 197.00, 45),
  ('2023-01-20', 'Assinatura BI', 'Software', 89.90, 28),
  ('2023-02-05', 'Consultoria', 'Servi√ßos', 1200.00, 3),
  ('2023-02-12', 'Curso SQL', 'Educa√ß√£o', 147.00, 52),
  ('2023-03-01', 'Licen√ßa Tableau', 'Software', 999.00, 15);
EOF

# Criar Dockerfile para a API
cat > api/Dockerfile << 'EOF'
FROM python:3.10-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
EOF

# Requisitos para a API
cat > api/requirements.txt << 'EOF'
fastapi==0.104.0
uvicorn==0.23.2
sqlalchemy==2.0.22
psycopg2-binary==2.9.9
pydantic==2.4.2
EOF

# Criar Dockerfile para o Dashboard
cat > dashboard/Dockerfile << 'EOF'
FROM python:3.10-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["streamlit", "run", "app.py", "--server.address=0.0.0.0"]
EOF

# Requisitos para o Dashboard
cat > dashboard/requirements.txt << 'EOF'
streamlit==1.31.0
pandas==2.1.0
plotly==5.18.0
requests==2.31.0
EOF

# Iniciar todos os servi√ßos
docker-compose up -d

# Verificar logs dos servi√ßos
docker-compose logs -f

# Parar todos os servi√ßos
docker-compose down

# Parar e remover volumes (limpar dados)
docker-compose down -v</code></pre>
                    </div>
                    <div class="example-description">
                        <p><strong>Benef√≠cios neste exemplo:</strong></p>
                        <ul>
                            <li>Stack completa de an√°lise de dados orquestrada com um √∫nico comando</li>
                            <li>Comunica√ß√£o entre servi√ßos usando a rede interna do Docker</li>
                            <li>Fluxo de dados bidirecional: inser√ß√£o de dados via dashboard ‚Üí API ‚Üí banco de dados</li>
                            <li>Atualiza√ß√£o em tempo real dos gr√°ficos ap√≥s inser√ß√£o de novos dados</li>
                            <li>Persist√™ncia de dados com volumes Docker</li>
                            <li>Pipeline de dados completo com feedback circular</li>
                        </ul>
                        <p><strong>Fluxo completo de dados:</strong></p>
                        <ol>
                            <li>Usu√°rio insere dados no dashboard Streamlit</li>
                            <li>Dashboard envia dados para a API FastAPI</li>
                            <li>API persiste dados no PostgreSQL</li>
                            <li>Dashboard consulta API para atualizar visualiza√ß√µes</li>
                            <li>API obt√©m dados do PostgreSQL</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Docker 101 - Um guia para iniciantes sobre containeriza√ß√£o</p>
            <p>Criado como projeto educacional</p>
            <p><a href="https://www.docker.com" target="_blank">Visite o site oficial do Docker</a></p>
            <p class="author-credit">Desenvolvido por <a href="https://github.com/alanceloth/" target="_blank">Alan Lanceloth</a></p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="js/copy-code.js"></script>
    <script src="scripts/main.js"></script>
</body>
</html>
